<!DOCTYPE html>
<html>
<head>
  <title>Mapa ManabÃ­ â€“ Outline limpio</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: transparent !important;
      overflow: hidden;
    }

    #map { width: 100%; height: 100%; }

    .leaflet-container { 
      background: transparent !important;
    }

    .leaflet-control-attribution { 
      display: none !important; 
    }

    .leaflet-tooltip.manabi-tooltip {
      background: rgba(255, 255, 255, 0.93);
      color: #000;
      padding: 5px 8px;
      border-radius: 6px;
      font-size: 12.5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
      border: 1px solid #dcdcdc;
      font-family: system-ui, sans-serif;
      max-width: 180px;
      text-align: center;
      line-height: 1.3;
      white-space: normal;
    }
  </style>
</head>

<body>

<div id="map"></div>

<script>
  const isMobile = window.innerWidth < 700;

  var map = L.map('map', {
    zoomControl: true,
    attributionControl: false
  }).setView([-0.9, -80.3], 8);

  function normalizarNombre(nombre) {
    return nombre
      ? nombre.toString().toLowerCase()
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim()
      : "";
  }

  // Parroquias rurales de ManabÃ­
  const ruralesManabi = {
    "24 de mayo": ["bellavista","noboa"],
    "bolivar": ["membrillo","quiroga"],
    "chone": ["boyaca","canuto","chibunga","convento","eloy alfaro","ricaurte","san antonio"],
    "el carmen": ["paraiso (la 14)","san pedro de suma","santa maria","wilfrido loor moreira"],
    "flavio alfaro": ["san francisco de novillo","zapallo jarry"],
    "jipijapa": ["el anegado","julcuy","la america","la union","membrillal","pedro pablo gomez","puerto cayo"],
    "manta": ["san lorenzo","santa marianita"],
    "montecristi": ["la pila"],
    "pajan": ["campozano","cascol","guale","lascano"],
    "pedernales": ["10 de agosto","atahualpa","cojimies"],
    "pichincha": ["barraganete","san sebastian"],
    "portoviejo": ["abdon calderon","alajuela","churijos","crucita","pueblo nuevo","rio chico","san placido"],
    "puerto lopez": ["machalilla","salango"],
    "san vicente": ["canoa"],
    "santa ana": ["ayacucho","honorato vasquez","la union","san pablo de pueblo nuevo"],
    "sucre": ["charapoto","san isidro"],
    "tosagua": ["angel pedro giler","san jose de bachillero"]
  };

  function esParroquiaRural(p) {
    const c = normalizarNombre(p.CANTON);
    const pr = normalizarNombre(p.PARROQUIA);
    return (ruralesManabi[c] || []).includes(pr);
  }

  // OJO: seguimos usando el mismo GeoJSON, pero subiendo un nivel
  fetch('../parroquias_manabi.geojson')
    .then(r => r.json())
    .then(data => {

      var manabiLayer = L.geoJSON(data, {
        /* â­ OUTLINE LIMPIO: solo borde, sin sombra ni relleno â­ */
        style: f => ({
          color: "#111",      // color del borde
          weight: 1.4,        // grosor del borde (puedes bajar o subir)
          fillColor: "transparent",
          fillOpacity: 0      // sin relleno interno
        }),

        onEachFeature: function (feature, layer) {

          let p = feature.properties;
          let etiqueta;

          if (esParroquiaRural(p)) {
            etiqueta = `
              <div style="line-height:1.25;">
                <strong style="font-size:14px;">${p.PARROQUIA} (P.R.)</strong><br>
                <span style="font-size:11px; opacity:0.8;">${p.CANTON}</span>
              </div>`;
          } else {
            etiqueta = `
              <div style="line-height:1.25;">
                <strong style="font-size:14px;">${p.CANTON}</strong><br>
                <span style="font-size:11px; opacity:0.8;">Zona Urbana</span>
              </div>`;
          }

          layer.bindTooltip(etiqueta, {
            sticky: !isMobile,
            direction: "auto",
            opacity: 0.95,
            offset: [0, -8],
            className: "manabi-tooltip"
          });

          layer.on("mouseover", e => {
            e.target.setStyle({
              color: "#000",
              weight: 2,
            });
          });

          layer.on("mouseout", e => {
            manabiLayer.resetStyle(e.target);
          });

        }

      }).addTo(map);

      map.fitBounds(manabiLayer.getBounds(), {
        padding: isMobile ? [10, 10] : [35, 35]
      });

      // ðŸ‘‡ Eliminamos la sombra (drop-shadow) para que sea outline puro
      // Antes aquÃ­ habÃ­a un setTimeout con svg.style.filter = 'drop-shadow(...)'
      // ya no lo usamos.
    });
</script>

</body>
</html>
