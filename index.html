<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapa Manabí – Manabiteando</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
    }

    #map {
      width: 100%;
      height: 100%;
      background: #000;
    }

    .leaflet-container {
      background: #000 !important;
    }

    .leaflet-control-attribution {
      display: none !important;
    }

    /* Tarjeta del popup (la nube grande) */
    .leaflet-popup-content-wrapper {
      border-radius: 28px !important;
      padding: 0 !important;
      background: rgba(255,255,255,0.94) !important;
      box-shadow: 0 14px 28px rgba(0,0,0,0.55);
      border: 1px solid rgba(220,220,220,0.9);
    }

    .leaflet-popup-content {
      margin: 0 !important;
      padding: 14px 18px 16px 18px !important;
      text-align: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
                   "Segoe UI", sans-serif;
    }

    .titulo-popup {
      font-size: 22px;
      font-weight: 800;
      color: #111;
      line-height: 1.1;
      margin-bottom: 6px;
    }

    .subtitulo-popup {
      font-size: 16px;
      color: #444;
      line-height: 1.25;
    }

    /* Quitar borde negro/blanco al hacer click en el polígono */
    .leaflet-interactive:focus,
    .leaflet-interactive:focus-visible {
      outline: none !important;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Función para limpiar y formatear nombres
function formatearNombreParroquia(nombre) {
    nombre = nombre.trim();

    // Regla especial para Puerto de Cayo → Pto. Cayo
    if (nombre.toLowerCase() === "puerto de cayo") {
        return "Pto. Cayo";
    }

    // El Anegado ya está correcto, solo quitamos textos innecesarios
    nombre = nombre.replace(/\(.*?\)/g, "").trim();

    return nombre;
}

// Determinar si es parroquia rural
function esParroquiaRural(props) {
    const tipo = props.DPA_DESPAR?.toLowerCase() || "";
    return tipo.includes("cab en") || tipo.includes("parroquia");
}

// Estilo general del mapa
const map = L.map("map", {
    zoomControl: false,
    attributionControl: false,
    dragging: false,
    scrollWheelZoom: false,
    doubleClickZoom: false,
    boxZoom: false,
    keyboard: false,
}).setView([-1.2, -80.4], 8);

// Cargar geojson
fetch("parroquias_manabi.geojson")
    .then(res => res.json())
    .then(data => {
        L.geoJSON(data, {
            style: {
                color: "#000",
                weight: 1,
                fillColor: "#e8e8e8",
                fillOpacity: 1
            },
            onEachFeature: (feature, layer) => {
                const props = feature.properties;
                const canton = props.DPA_DESCAN;
                let parroquia = props.DPA_DESPAR || "";

                let titulo = "";
                let subtitulo = "";

                if (esParroquiaRural(props)) {
                    // Parroquia Rural
                    const nombreLimpio = formatearNombreParroquia(parroquia);
                    titulo = `${nombreLimpio} (P.R.)`;
                    subtitulo = `${canton}`;
                } else {
                    // Zona urbana
                    titulo = `${canton}`;
                    subtitulo = `Zona Urbana`;
                }

                const popupContent = `
                    <div style="
                        padding: 18px;
                        background: rgba(255,255,255,0.9);
                        backdrop-filter: blur(6px);
                        border-radius: 30px;
                        border: 1px solid rgba(255,255,255,0.4);
                        box-shadow: 0 4px 20px rgba(0,0,0,0.25);
                        text-align: center;
                        font-family: 'Arial';
                    ">
                        <div style="
                            font-size: 28px;
                            font-weight: 900;
                            margin-bottom: 6px;
                        ">
                            ${titulo}
                        </div>
                        <div style="
                            font-size: 22px;
                            opacity: 0.8;
                            font-weight: 500;
                        ">
                            ${subtitulo}
                        </div>
                    </div>
                `;

                layer.bindPopup(popupContent, {
                    className: "custom-popup",
                    closeButton: false
                });

                // Resalta al pulsar
                layer.on("click", function () {
                    this.setStyle({ fillColor: "#cccccc" });
                    setTimeout(() => {
                        this.setStyle({ fillColor: "#e8e8e8" });
                    }, 600);
                });
            }
        }).addTo(map);
    });
</script>
</body>
</html>

