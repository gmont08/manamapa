<!DOCTYPE html>
<html>
<head>
  <title>Mapa Manabí – Manabiteando</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      overflow: hidden;
    }

    #map { width: 100%; height: 100%; }

    .leaflet-container { background: #000 !important; }

    .leaflet-control-attribution { display: none !important; }

    /* Tooltip estilizado */
    .leaflet-tooltip.manabi-tooltip {
      background: rgba(255, 255, 255, 0.93);
      color: #000;
      padding: 5px 8px;
      border-radius: 6px;
      font-size: 12.5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
      border: 1px solid #dcdcdc;
      font-family: system-ui, sans-serif;
      max-width: 180px;
      white-space: normal;
      text-align: center;
      line-height: 1.3;
    }

    @media (max-width: 700px) {
      .leaflet-tooltip.manabi-tooltip {
        font-size: 14px;
        max-width: 220px;
      }
    }
  </style>
</head>

<body>
<div id="map"></div>

<script>
  const isMobile = window.innerWidth < 700;

  var map = L.map('map', {
    zoomControl: true,
    attributionControl: false
  }).setView([-0.9, -80.3], 8);

  const parroquiasCompletadas = [];

  function normalizarNombre(nombre) {
    return nombre
      ? nombre.toString().toLowerCase()
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim()
      : "";
  }

  const ruralesManabi = {
    "24 de mayo": ["bellavista","noboa"],
    "bolivar": ["membrillo","quiroga"],
    "chone": ["boyaca","canuto","chibunga","convento","eloy alfaro","ricaurte","san antonio"],
    "el carmen": ["paraiso (la 14)","san pedro de suma","santa maria","wilfrido loor moreira"],
    "flavio alfaro": ["san francisco de novillo","zapallo jarry"],
    "jipijapa": ["el anegado","julcuy","la america","la union","membrillal","pedro pablo gomez","puerto cayo"],
    "manta": ["san lorenzo","santa marianita"],
    "montecristi": ["la pila"],
    "pajan": ["campozano","cascol","guale","lascano"],
    "pedernales": ["10 de agosto","atahualpa","cojimies"],
    "pichincha": ["barraganete","san sebastian"],
    "portoviejo": ["abdon calderon","alajuela","churijos","crucita","pueblo nuevo","rio chico","san placido"],
    "puerto lopez": ["machalilla","salango"],
    "san vicente": ["canoa"],
    "santa ana": ["ayacucho","honorato vasquez","la union","san pablo de pueblo nuevo"],
    "sucre": ["charapoto","san isidro"],
    "tosagua": ["angel pedro giler","san jose de bachillero"]
  };

  function esParroquiaRural(p) {
    const c = normalizarNombre(p.CANTON);
    const pr = normalizarNombre(p.PARROQUIA);
    return (ruralesManabi[c] || []).includes(pr);
  }

  fetch('parroquias_manabi.geojson')
    .then(r => r.json())
    .then(data => {

      var manabiLayer = L.geoJSON(data, {
        style: f => ({
          color: "#555",
          weight: 1,
          fillColor: parroquiasCompletadas.includes(f.properties.CODIGO)
                     ? "#c8f7c5" : "#f5f5f5",
          fillOpacity: 0.95
        }),

        onEachFeature: function (feature, layer) {

          let p = feature.properties;
          let etiqueta;

          if (esParroquiaRural(p)) {
            etiqueta = `${p.CANTON} – ${p.PARROQUIA} (P.R.)`;
          } else {
            // URBANA = CANTÓN / ZONA URBANA
            etiqueta = `${p.CANTON}\nZona Urbana`;
          }

          layer.bindTooltip(
            `<div>${etiqueta.replace("\n", "<br>")}</div>`,
            {
              sticky: !isMobile,
              direction: "auto",
              opacity: 0.95,
              offset: [0, -8],
              className: "manabi-tooltip"
            }
          );

          layer.on("mouseover", e => {
            e.target.setStyle({ fillOpacity: 1, fillColor: "#ffffff" });
          });

          layer.on("mouseout", e => {
            manabiLayer.resetStyle(e.target);
          });
        }

      }).addTo(map);

      map.fitBounds(manabiLayer.getBounds(), {
        padding: isMobile ? [10, 10] : [35, 35]
      });

      setTimeout(() => {
        const svg = document.querySelector('.leaflet-overlay-pane svg');
        if (svg) svg.style.filter = 'drop-shadow(0px 12px 14px rgba(0,0,0,0.85))';
      }, 300);
    });
</script>

</body>
</html>
